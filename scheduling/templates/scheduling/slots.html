{% extends "scheduling/base.html" %}
{% load schedule_extras %}
{% block title %}Slots{% endblock %}
{% block content %}
<div class="bg-white rounded-xl shadow p-4">
    <h1 class="text-xl font-semibold">Slots (Shift rows)</h1>
    <p class="text-sm text-gray-600 mt-1">Unique key = no duplicate time rows (example: only one 4pm).</p>

    {% if error %}
        <div class="mt-3 rounded border border-red-200 bg-red-50 text-red-700 px-3 py-2 text-sm">{{ error }}</div>
    {% endif %}

    <form method="post" class="mt-4 grid grid-cols-1 lg:grid-cols-6 gap-3 items-end">
        {% csrf_token %}
        <input type="hidden" name="add_slot" value="1">

        <div class="lg:col-span-2">
            <label class="text-sm text-gray-600">Label</label>
            <input name="label" class="w-full rounded border px-3 py-2" placeholder="e.g. 4pm">
        </div>

        <div>
            <label class="text-sm text-gray-600">Key</label>
            <input name="key" class="w-full rounded border px-3 py-2" placeholder="e.g. 4pm">
        </div>

        <div>
            <label class="text-sm text-gray-600">Order</label>
            <input name="sort_order" class="w-full rounded border px-3 py-2" value="100">
        </div>

        <div>
            <label class="text-sm text-gray-600">Bg type</label>
            <select name="bg_type" class="w-full rounded border px-3 py-2">
                <option value="solid">Solid</option>
                <option value="gradient">Gradient</option>
            </select>
        </div>

        <div class="grid grid-cols-2 gap-2">
            <div>
                <label class="text-sm text-gray-600">Color 1</label>
                <input name="bg_color1" class="w-full rounded border px-2 py-2" value="#ffffff">
            </div>
            <div>
                <label class="text-sm text-gray-600">Color 2</label>
                <input name="bg_color2" class="w-full rounded border px-2 py-2" value="#ffffff">
            </div>
        </div>

        <div>
            <label class="text-sm text-gray-600">Text</label>
            <input name="text_color" class="w-full rounded border px-3 py-2" value="#111827">
        </div>

        <div class="flex items-center gap-2">
            <input id="allow_block_new" type="checkbox" name="allow_block" class="h-4 w-4">
            <label for="allow_block_new" class="text-sm text-gray-700">Allow block</label>
        </div>

        <div>
            <label class="text-sm text-gray-600">PT default time</label>
            <input name="pt_default_time" class="w-full rounded border px-3 py-2" value="7-11">
            <div class="text-xs text-gray-500 mt-1">Used only for PT slot key.</div>
        </div>

        <div class="lg:col-span-6 flex justify-end">
            <button class="rounded bg-black text-white px-4 py-2">Add slot</button>
        </div>
    </form>
</div>

<div class="bg-white rounded-xl shadow p-4 mt-4">
    <h2 class="font-semibold">Existing slots</h2>
    <div class="mt-3 space-y-3">
        {% for s in slots %}
            <div class="rounded border p-3">
                <div class="flex items-start justify-between gap-3 flex-wrap">
                    <div class="min-w-[220px]">
                        <div class="text-sm font-semibold">{{ s.label }}</div>
                        <div class="text-xs text-gray-500">key: {{ s.key }}</div>
                    </div>

                    <div class="flex items-center gap-2">
                        <div class="h-8 w-24 rounded border" style="{% if s.bg_type == 'gradient' %}background-image: linear-gradient(90deg, {{ s.bg_color1 }}, {{ s.bg_color2 }});{% else %}background-color: {{ s.bg_color1 }};{% endif %}"></div>
                        <span class="text-xs text-gray-500">{{ s.bg_type }}</span>
                    </div>

                    <form method="post" action="/schedule/slots/{{ s.id }}/delete/">
                        {% csrf_token %}
                        <button class="text-sm text-red-600 hover:underline">Delete</button>
                    </form>
                </div>

                <form method="post" class="mt-3 grid grid-cols-1 md:grid-cols-6 gap-2 items-end">
                    {% csrf_token %}
                    <input type="hidden" name="update_slot" value="1">
                    <input type="hidden" name="slot_id" value="{{ s.id }}">

                    <div class="md:col-span-2">
                        <label class="text-xs text-gray-600">Label</label>
                        <input name="label" value="{{ s.label }}" class="w-full rounded border px-3 py-2">
                    </div>

                    <div>
                        <label class="text-xs text-gray-600">Order</label>
                        <input name="sort_order" value="{{ s.sort_order }}" class="w-full rounded border px-3 py-2">
                    </div>

                    <div>
                        <label class="text-xs text-gray-600">Bg type</label>
                        <select name="bg_type" class="w-full rounded border px-3 py-2">
                            <option value="solid" {% if s.bg_type == "solid" %}selected{% endif %}>Solid</option>
                            <option value="gradient" {% if s.bg_type == "gradient" %}selected{% endif %}>Gradient</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label class="text-xs text-gray-600">Color 1</label>
                            <input name="bg_color1" value="{{ s.bg_color1 }}" class="w-full rounded border px-2 py-2">
                        </div>
                        <div>
                            <label class="text-xs text-gray-600">Color 2</label>
                            <input name="bg_color2" value="{{ s.bg_color2 }}" class="w-full rounded border px-2 py-2">
                        </div>
                    </div>

                    <div>
                        <label class="text-xs text-gray-600">Text</label>
                        <input name="text_color" value="{{ s.text_color }}" class="w-full rounded border px-3 py-2">
                    </div>

                    <div class="flex items-center gap-2">
                        <input id="allow_block_{{ s.id }}" type="checkbox" name="allow_block" class="h-4 w-4" {% if s.allow_block %}checked{% endif %}>
                        <label for="allow_block_{{ s.id }}" class="text-sm text-gray-700">Allow block</label>
                    </div>

                    {% if s.key == pt_key %}
                        <div class="md:col-span-2">
                            <label class="text-xs text-gray-600">PT default time</label>
                            <input name="pt_default_time" value="{{ s.pt_default_time }}" class="w-full rounded border px-3 py-2">
                        </div>
                    {% endif %}

                    <div class="md:col-span-6 flex justify-end">
                        <button class="rounded bg-black text-white px-4 py-2">Save</button>
                    </div>
                </form>
            </div>
        {% empty %}
            <div class="text-sm text-gray-500">No slots yet.</div>
        {% endfor %}
    </div>
</div>
{% endblock %}
